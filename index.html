<html>
<script src='https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.1.2/dist/tf.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.4.2"></script>
Steps: <input type='number' value='100' id='steps'/><br>
Variance: <input type='range' min='1' max='2' step='0.1' value='1.5' id='temp'/><br>
<input type='button' value='PLAY'/>
<canvas id='canvas'></canvas>
<script>
  function viz(x) {
    var viz = new mm.Visualizer(x, document.getElementById('canvas'));

    vizPlayer = new mm.Player(false, {
      run: (note) => viz.redraw(note),
      stop: () => {console.log('done');}
    });
  }

  music_rnn = new mm.MusicRNN('https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/melody_rnn');
  music_rnn.initialize();

  rnnPlayer = new mm.Player();

  var sx;

  function play(x, steps, temperature) {

    const qns = mm.sequences.quantizeNoteSequence(x, 4);
    music_rnn
    .continueSequence(qns, steps, temperature)
    .then(function (sample) {
      viz(sample)
      sx = sample;
      rnnPlayer.start(sample);
    });
  }

  var replay = function () {
    rnnPlayer.start(sx)
  }

  music_vae = new mm.MusicVAE('https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/groovae_2bar_humanize');
  music_vae.initialize();

  vaePlayer = new mm.Player();

  function playVAE(steps, temp) {
    music_vae
    .sample(1, temp||1.5)
    .then(function (sample) {
      play(sample[0], steps, temp||1.5)

    });
  }
  
  document.getElementById("play").addEventListener("click", function () {
    var steps = parseInt(document.getElementById("steps").value);
    var temp = parseInt(document.getElementById("temp").value);
    play(steps, temp);
  });
</script>
</html>
